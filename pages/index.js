import Head from 'next/head';
import { Fragment, useState } from 'react';
import ArtistCard from '../components/ArtistCard';
import { getArtistInfoForHome } from '../data';
import styles from './Home.module.css';

export default function Home({ artistList }) {
  const [filteredArtists, setFilteredArtists] = useState(artistList);
  const [searchInput, setSearchInput] = useState('');

  const onSearchChange = (e) => {
    setSearchInput(e.target.value);

    if (!e.target.value) {
      setFilteredArtists(artistList);
    } else {
      let search = e.target.value.toLowerCase();
      let result = [];

      artistList.forEach((artist) => {
        let artistName = artist.name.toLowerCase();
        let artistGenre = artist.genre.toLowerCase();

        if (artistName.includes(search) || artistGenre.includes(search)) {
          result.push(artist);
        }
      });

      setFilteredArtists(result);
    }
  };

  return (
    <Fragment>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <section className={styles.heroSection}>
          <h1>Better Music</h1>
        </section>

        <section className={styles.artistSection}>
          <h2>Artists</h2>

          <div className={styles.searchContainer}>
            <div className={styles.formGroup}>
              <input
                value={searchInput}
                onChange={onSearchChange}
                type="input"
                className={styles.formField}
                name="artistSearch"
                id="artistSearch"
                required
              />
              <label htmlFor="artistSearch" className={styles.formLabel}>
                Search Artists
              </label>
            </div>
          </div>

          <ul className={styles.artistCardsContainer}>
            {filteredArtists.map((artist, index) => {
              return (
                <li key={`artist-${index}`}>
                  <ArtistCard
                    name={artist.name}
                    id={artist.id}
                    genre={artist.genre}
                    src={artist.profileSrc}
                    alt={artist.profileAlt}
                  />
                </li>
              );
            })}
          </ul>
        </section>
      </main>
    </Fragment>
  );
}

export async function getStaticProps() {
  const artistList = getArtistInfoForHome();

  if (!artistList) {
    return {
      notFound: true,
    };
  }

  return {
    props: { artistList },
    revalidate: 60000,
  };
}
